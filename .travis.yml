language: node_js

node_js:
  - node

branches:
  # only:
  # - master

before_install:
  - npm install -g hexo

install:
  - npm install

script:
  - hexo generate

before_deploy:
  - pip install awscli --upgrade --user
  - aws s3 rm s3://www.juanmanuelruizfernandez.com --recursive

deploy:
  provider: s3
  region: eu-west-1
  bucket: www.juanmanuelruizfernandez.com
  skip_cleanup: true
  local_dir: public
  on:
    branch: develop
  acl: public_read

after_deploy:
  # Allow `awscli` to make requests to CloudFront.
  - aws configure set preview.cloudfront true
  # Invalidate every object in the targeted distribution.
  - aws cloudfront create-invalidation --distribution-id E2515A2ZDSBPQJ
